[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "CalCOFI.io Docs",
    "section": "",
    "text": "1 Process\n\n\n\n\n\n\n\nFigureÂ 1.1: CalCOFI data workflow.\n\n\n\nThe original raw data, most often in tabular format [e.g., comma-separated value (*.csv)], gets ingested into the database by R scripts that use functions and lookup data tables in the R package calcofi4r where functions are organized into Read, Analyze and Visualize concepts. The application programming interface (API) provides a program-language-agnostic public interface for rendering subsets of data and custom visualizations given a set of documented input parameters for feeding interactive applications (Apps) using Shiny (or any other web application framework) and reports using Rmarkdown (or any other report templating framework). Finally, R scripts will publish metadata (as Ecological Metadata Language) and data packages (e.g., in Darwin format) for discovery on a variety of data portals oriented around slicing the tabular or gridded data (ERDDAP), biogeographic analysis (OBIS), long-term archive (DataOne, NCEI) or metadata discovery (InPort). The database will be spatially enabled by PostGIS for summarizing any and all data by Areas of Interest (AoIs), whether pre-defined (e.g., sanctuaries, MPAs, counties, etc.) or arbitrary new areas. (FigureÂ 1.1)\n\nERDDAP: great for gridded or tabular data, but does not aggregate on the server or clip to a specific area of interest",
    "crumbs": [
      "<span class='chapter-number'>1</span>Â  <span class='chapter-title'>Process</span>"
    ]
  },
  {
    "objectID": "reports.html",
    "href": "reports.html",
    "title": "2Â  Reports",
    "section": "",
    "text": "2.1 Sanctuaries",
    "crumbs": [
      "<span class='chapter-number'>2</span>Â  <span class='chapter-title'>Reports</span>"
    ]
  },
  {
    "objectID": "reports.html#sanctuaries",
    "href": "reports.html#sanctuaries",
    "title": "2Â  Reports",
    "section": "",
    "text": "Channel Islands WebCR\nweb-enabled Condition Report\n\nForage Fish\nexample of using calcofi4r functions that pull from the API\n\nUCSB Student Capstone",
    "crumbs": [
      "<span class='chapter-number'>2</span>Â  <span class='chapter-title'>Reports</span>"
    ]
  },
  {
    "objectID": "apps.html",
    "href": "apps.html",
    "title": "3Â  Applications",
    "section": "",
    "text": "CalCOFI Oceanography\noceanographic summarization by arbitrary area of interest and sampling period\nUCSB Student Capstone",
    "crumbs": [
      "<span class='chapter-number'>3</span>Â  <span class='chapter-title'>Applications</span>"
    ]
  },
  {
    "objectID": "api.html",
    "href": "api.html",
    "title": "4Â  API",
    "section": "",
    "text": "4.1 /variables: get list of variables for timeseries\nGet list of variables for use in /timeseries",
    "crumbs": [
      "<span class='chapter-number'>4</span>Â  <span class='chapter-title'>API</span>"
    ]
  },
  {
    "objectID": "api.html#species_groups-get-species-groups-for-larvae",
    "href": "api.html#species_groups-get-species-groups-for-larvae",
    "title": "4Â  API",
    "section": "4.2 /species_groups: get species groups for larvae",
    "text": "4.2 /species_groups: get species groups for larvae\nNot yet working. Get list of species groups for use with variables larvae_counts.count in /timeseries",
    "crumbs": [
      "<span class='chapter-number'>4</span>Â  <span class='chapter-title'>API</span>"
    ]
  },
  {
    "objectID": "api.html#timeseries-get-time-series-data",
    "href": "api.html#timeseries-get-time-series-data",
    "title": "4Â  API",
    "section": "4.3 /timeseries: get time series data",
    "text": "4.3 /timeseries: get time series data",
    "crumbs": [
      "<span class='chapter-number'>4</span>Â  <span class='chapter-title'>API</span>"
    ]
  },
  {
    "objectID": "api.html#cruises-get-list-of-cruises",
    "href": "api.html#cruises-get-list-of-cruises",
    "title": "4Â  API",
    "section": "4.4 /cruises: get list of cruises",
    "text": "4.4 /cruises: get list of cruises\nGet list of cruises with summary stats as CSV table for time (date_beg)",
    "crumbs": [
      "<span class='chapter-number'>4</span>Â  <span class='chapter-title'>API</span>"
    ]
  },
  {
    "objectID": "api.html#raster-get-raster-map-of-variable",
    "href": "api.html#raster-get-raster-map-of-variable",
    "title": "4Â  API",
    "section": "4.5 /raster: get raster map of variable",
    "text": "4.5 /raster: get raster map of variable\nGet raster of variable",
    "crumbs": [
      "<span class='chapter-number'>4</span>Â  <span class='chapter-title'>API</span>"
    ]
  },
  {
    "objectID": "api.html#cruise_lines-get-station-lines-from-cruises",
    "href": "api.html#cruise_lines-get-station-lines-from-cruises",
    "title": "4Â  API",
    "section": "4.6 /cruise_lines: get station lines from cruises",
    "text": "4.6 /cruise_lines: get station lines from cruises\nGet station lines from cruises (with more than one cast)",
    "crumbs": [
      "<span class='chapter-number'>4</span>Â  <span class='chapter-title'>API</span>"
    ]
  },
  {
    "objectID": "api.html#cruise_line_profile",
    "href": "api.html#cruise_line_profile",
    "title": "4Â  API",
    "section": "4.7 /cruise_line_profile",
    "text": "4.7 /cruise_line_profile\nGet profile at depths for given variable of casts along line of stations",
    "crumbs": [
      "<span class='chapter-number'>4</span>Â  <span class='chapter-title'>API</span>"
    ]
  },
  {
    "objectID": "db.html",
    "href": "db.html",
    "title": "5Â  Database",
    "section": "",
    "text": "5.1 Database naming conventions\nWeâ€™re circling the wagons to come up with the best conventions for naming. Here are some ideas:",
    "crumbs": [
      "<span class='chapter-number'>5</span>Â  <span class='chapter-title'>Database</span>"
    ]
  },
  {
    "objectID": "db.html#database-naming-conventions",
    "href": "db.html#database-naming-conventions",
    "title": "5Â  Database",
    "section": "",
    "text": "Learn SQL: Naming Conventions\nBest Practices for Database Naming Conventions - Drygast.NET\n\n\n5.1.1 Name tables\n\nTable names are plural and use all lower case.\n\n\n\n5.1.2 Name columns\n\nTo name columns, use snake-case (i.e., lower-case with underscores) so as to prevent the need to quote SQL statements. (TIP: Use janitor::clean_names() to convert a table.)\nUnique identifiers are suffixed with:\n\n*_id for unique integer keys;\n*_key for unique string keys;\n*_seq for auto-incrementing sequence integer keys.\n\nSuffix with units where applicable (e.g., *_m for meters, *_km for kilometers, degc for degrees Celsius). See units vignette.\nSet geometry column to geom (used by PostGIS spatial extension). If the table has multiple geometry columns, use geom for the default geometry column and geom_{type} for additional geometry columns (e.g., geom_point, geom_line, geom_polygon).",
    "crumbs": [
      "<span class='chapter-number'>5</span>Â  <span class='chapter-title'>Database</span>"
    ]
  },
  {
    "objectID": "db.html#use-unicode-for-text",
    "href": "db.html#use-unicode-for-text",
    "title": "5Â  Database",
    "section": "5.2 Use Unicode for text",
    "text": "5.2 Use Unicode for text\nThe default character encoding for Postgresql is unicode (UTF8), which allows for international characters, accents and special characters. Improper encoding can royally mess up basic text.\nLogging into the server, we can see this with the following command:\ndocker exec -it postgis psql -l\n                                  List of databases\n        Name        | Owner | Encoding |  Collate   |   Ctype    | Access privileges \n--------------------+-------+----------+------------+------------+-------------------\n gis                | admin | UTF8     | en_US.utf8 | en_US.utf8 | =Tc/admin        +\n                    |       |          |            |            | admin=CTc/admin  +\n                    |       |          |            |            | ro_user=c/admin\n lter_core_metabase | admin | UTF8     | en_US.utf8 | en_US.utf8 | =Tc/admin        +\n                    |       |          |            |            | admin=CTc/admin  +\n                    |       |          |            |            | rw_user=c/admin\n postgres           | admin | UTF8     | en_US.utf8 | en_US.utf8 | \n template0          | admin | UTF8     | en_US.utf8 | en_US.utf8 | =c/admin         +\n                    |       |          |            |            | admin=CTc/admin\n template1          | admin | UTF8     | en_US.utf8 | en_US.utf8 | =c/admin         +\n                    |       |          |            |            | admin=CTc/admin\n template_postgis   | admin | UTF8     | en_US.utf8 | en_US.utf8 | \n(6 rows)\nUse Unicode (utf-8 in Python or UTF8 in Postgresql) encoding for all database text values to support international characters and documentation (i.e., tabs, etc for markdown conversion).\n\nIn Python, use pandas to read (read_csv()) and write (to_csv()) with UTF-8 encoding (i.e., encoding='utf-8').:\nimport pandas as pd\nfrom sqlalchemy import create_engine\nengine = create_engine('postgresql://user:password@localhost:5432/dbname')\n\n# read from a csv file\ndf = pd.read_csv('file.csv', encoding='utf-8')\n\n# write to PostgreSQL\ndf.to_sql('table_name', engine, if_exists='replace', index=False, method='multi', chunksize=1000, encoding='utf-8')\n\n# read from PostgreSQL\ndf = pd.read_sql('SELECT * FROM table_name', engine, encoding='utf-8')\n\n# write to a csv file with UTF-8 encoding\ndf.to_csv('file.csv', index=False, encoding='utf-8')\nIn R, use readr to read (read_csv()) and write (write_excel_csv()) to force UTF-8 encoding.\nlibrary(readr)\nlibrary(DBI)\nlibrary(RPostgres)\n\n# connect to PostgreSQL\ncon &lt;- dbConnect(RPostgres::Postgres(), dbname = \"dbname\", host = \"localhost\", port = 5432, user = \"user\", password = \"password\")\n\n# read from a csv file\ndf &lt;- read_csv('file.csv', locale = locale(encoding = 'UTF-8'))  # explicit\ndf &lt;- read_csv('file.csv')                                       # implicit\n\n# write to PostgreSQL\ndbWriteTable(con, 'table_name', df, overwrite = TRUE)\n\n# read from PostgreSQL\ndf &lt;- dbReadTable(con, 'table_name')\n\n# write to a csv file with UTF-8 encoding\nwrite_excel_csv(df, 'file.csv', locale = locale(encoding = 'UTF-8'))  # explicit\nwrite_excel_csv(df, 'file.csv')                                       # implicit",
    "crumbs": [
      "<span class='chapter-number'>5</span>Â  <span class='chapter-title'>Database</span>"
    ]
  },
  {
    "objectID": "db.html#describe-tables-and-columns",
    "href": "db.html#describe-tables-and-columns",
    "title": "5Â  Database",
    "section": "5.3 Describe tables and columns",
    "text": "5.3 Describe tables and columns\n\nUse the COMMENT clause to add descriptions to tables and columns, either through the GUI pgadmin.calcofi.io (by right-clicking on the table or column and selecting Properties) or with SQL. For example:\nCOMMENT ON TABLE public.aoi_fed_sanctuaries IS 'areas of interest (`aoi`) polygons for federal **National Marine Sanctuaries**; loaded by _workflow_ [load_sanctuaries](https://calcofi.io/workflows/load_sanctuaries.html)';\nNote the use of markdown for including links and formatting (e.g., bold, code, italics), such that the above SQL will render like so:\n\nareas of interest (aoi) polygons for federal National Marine Sanctuaries; loaded by workflow load_sanctuaries\n\nIt is especially helpful to link to any workflows that are responsible for the ingesting or updating of the input data.\nThese descriptions can be viewed in the CalCOFI API api.calcofi.io as CSV tables (see code in calcofi/api: plumber.R):\n\napi.calcofi.io/db_tables\nfields:\n\n\nschema: (only â€œpublicâ€ so far)\ntable_type: â€œtableâ€, â€œviewâ€, or â€œmaterialized viewâ€ (none yet)\ntable: name of table\ntable_description: description of table (possibly in markdown)\n\napi.calcofi.io/db_columns\nfields:\n\n\nschema: (only â€œpublicâ€ so far)\ntable_type: â€œtableâ€, â€œviewâ€, or â€œmaterialized viewâ€ (none yet)\ntable: name of table\ncolumn: name of column\ncolumn_type: data type of column\ncolumn_description: description of column (possibly in markdown)\n\n\nFetch and display these descriptions into an interactive table with calcofi4r::cc_db_catalog().",
    "crumbs": [
      "<span class='chapter-number'>5</span>Â  <span class='chapter-title'>Database</span>"
    ]
  },
  {
    "objectID": "db.html#relationships-between-tables",
    "href": "db.html#relationships-between-tables",
    "title": "5Â  Database",
    "section": "5.4 Relationships between tables",
    "text": "5.4 Relationships between tables\n\nSee calcofi/workflows: clean_db\n\nTODO: add calcofi/apps: db to show latest tables, columns and relationsips",
    "crumbs": [
      "<span class='chapter-number'>5</span>Â  <span class='chapter-title'>Database</span>"
    ]
  },
  {
    "objectID": "db.html#spatial-tips",
    "href": "db.html#spatial-tips",
    "title": "5Â  Database",
    "section": "5.5 Spatial Tips",
    "text": "5.5 Spatial Tips\n\nUse ST_Subdivide() when running spatial joins on large polygons.",
    "crumbs": [
      "<span class='chapter-number'>5</span>Â  <span class='chapter-title'>Database</span>"
    ]
  },
  {
    "objectID": "portals.html",
    "href": "portals.html",
    "title": "6Â  Portals",
    "section": "",
    "text": "6.1 Overview\nCalCOFI data is available through various portals, each serving different purposes and user needs. This document outlines the main access points and their characteristics.",
    "crumbs": [
      "<span class='chapter-number'>6</span>Â  <span class='chapter-title'>Portals</span>"
    ]
  },
  {
    "objectID": "portals.html#overview",
    "href": "portals.html#overview",
    "title": "6Â  Portals",
    "section": "",
    "text": "6.1.1 EDI (Environmental Data Initiative)\n\nComplete dataset archives using DataOne software and EML metadata\nDOIs issued for all datasets ensuring citability\nFull archive allowing for any data file types\nBasic spatial and temporal filtering through web interface\nDownload in original formats with metadata\nAccess through DataOne API\nLinks:\n\nEDIrepository.org\nCalCOFI datasets: EDI query â€œCalCOFIâ€\n\n\n\n\n6.1.2 NCEI (National Centers for Environmental Information)\n\nLong-term archival of oceanographic data\nDOIs issued for dataset submissions\nStandardized metadata using ISO 19115-2\nBasic search interface with geographic and temporal filtering\nData preserved in original submission formats\nAccess through NCEI API services\nLinks:\n\nNCEI Ocean Archive\nCalCOFI datasets: NCEI search â€œCalCOFIâ€\n\n\n\n\n6.1.3 OBIS (Ocean Biodiversity Information System)\n\nSpecialized in marine biodiversity data\nStandardized using DarwinCore fields\nExtended measurements supported via extendedMeasurementOrFact\nPowerful filtering by space, time, and taxonomic parameters\nMultiple download formats (CSV, JSON, Darwin Core Archive)\nFull REST API access\nLinks:\n\nOBIS.org\nCalCOFI datasets: obis.org/dataset + â€œcalcofiâ€ Keyword\n\n\n\n\n6.1.4 ERDDAP (Environmental Research Division Data Access Program)\n\nTabular and gridded data server\nAdvanced subsetting by space, time, and parameters\nMultiple output formats (CSV, JSON, NetCDF, etc.)\nRESTful API with direct data access\nBuilt-in data visualization tools\nNo persistent identifiers but stable URLs\nLinks:\n\nERDDAP\nCalCOFI datasets:\n\nERDDAP, OceanView - CalCOFI seabirds\nERDDAP, CoastWatch - CalCOFI oceanographic",
    "crumbs": [
      "<span class='chapter-number'>6</span>Â  <span class='chapter-title'>Portals</span>"
    ]
  },
  {
    "objectID": "portals.html#meta-portals",
    "href": "portals.html#meta-portals",
    "title": "6Â  Portals",
    "section": "6.2 Meta-Portals",
    "text": "6.2 Meta-Portals\n\n6.2.1 Google Dataset Search\nThe JSON-LD metadata in the Portal dataset web pages get indexed by Google Dataset Search through schema.org metadata. This ensures that CalCOFI data is discoverable through Google search and other search engines.\n\n\n6.2.2 ODIS (Ocean Data Information System)\nODIS uses the same technology as Google Dataset Search (schema.org, JSON-LD), but focuses on ocean data. CalCOFI curates a sitemap of authoritative datasets to server to ODIS.org\nThis federated approach ensures that CalCOFI data remains:\n\nDiscoverable through multiple channels\nProperly cited and attributed\nIntegrated with global ocean data systems",
    "crumbs": [
      "<span class='chapter-number'>6</span>Â  <span class='chapter-title'>Portals</span>"
    ]
  },
  {
    "objectID": "portals.html#calcofi.io-tools",
    "href": "portals.html#calcofi.io-tools",
    "title": "6Â  Portals",
    "section": "6.3 CalCOFI.io Tools",
    "text": "6.3 CalCOFI.io Tools\nCalCOFI is also developing an integrated database and tools that enable efficient data access and analysis:\n\n6.3.1 APIs\n\nRESTful endpoints for programmatic access\nFiltering by space, time, and taxonomic parameters\nRelationship queries across tables\nLinks:\n\napi.calcofi.io\ntile.calcofi.io\n\n\n\n\n6.3.2 Library\n\nDirect data access from R\nBuilt-in analysis functions\nIntegration with tidyverse ecosystem\nLink:\n\ncalcofi.io/calcofi4r\n\n\n\n\n6.3.3 Apps\n\nInteractive data exploration with Shiny applications\nUser-friendly interfaces\nSubset and download data\nLink:\n\ncalcofi.io, App button",
    "crumbs": [
      "<span class='chapter-number'>6</span>Â  <span class='chapter-title'>Portals</span>"
    ]
  },
  {
    "objectID": "portals_a.html",
    "href": "portals_a.html",
    "title": "7Â  portals_a",
    "section": "",
    "text": "7.1 Data Flow\nWhile it would be ideal for CalCOFI data to be available through a single portal, each portal has its strengths and limitations. The following diagram illustrates one possible realization of data flow between CalCOFI data and the portals: from raw data to the integrated database to portals and meta-portals.\n%%{init: {\n  'theme': 'base',\n  'themeVariables': {\n    'primaryColor': '#E0E7FF',\n    'primaryTextColor': '#312E81',\n    'primaryBorderColor': '#6366F1',\n    'lineColor': '#818CF8',\n    'secondaryColor': '#FEF3C7',\n    'tertiaryColor': '#ECFDF5'\n  }\n}}%%\n\ngraph TD\n  %% nodes with styles\n  raw([raw data]):::source\n  db[(database)]:::database\n  \n  subgraph calcofi[CalCOFI.io]\n    web[calcofi.org]:::website\n    api[APIs]:::api\n    lib[library]:::code\n    app[apps]:::code\n    flow[workflows]:::code\n  end\n  \n  subgraph portals[Portals]\n    edi[EDI]:::portal\n    obis[OBIS]:::portal\n    erddap[ERDDAP]:::portal\n    ncei[NCEI]:::portal\n  end\n  \n  subgraph meta[Meta-Portals]\n    odis[ODIS]:::metaportal\n    datagov[data.gov]:::metaportal\n  end\n  \n  %% edges\n  raw --&gt; db\n  db  --&gt; api\n  db  --&gt; web\n  api --&gt; lib\n  api --&gt; app\n  api --&gt; flow\n  flow  --&gt; portals\n  portals --&gt;|sitemap| odis\n  portals --&gt; datagov\n\n  %% Custom styles\n  classDef source fill:#E0E7FF,stroke:#6366F1,stroke-width:2px\n  classDef database fill:#FEF3C7,stroke:#D97706,stroke-width:2px\n  classDef website fill:#F3E8FF,stroke:#9333EA,stroke-width:2px\n  classDef api fill:#E0E7FF,stroke:#6366F1,stroke-width:2px\n  classDef code fill:#DBEAFE,stroke:#3B82F6,stroke-width:2px\n  classDef portal fill:#F0FDF4,stroke:#22C55E,stroke-width:2px\n  classDef metaportal fill:#FEF2F2,stroke:#DC2626,stroke-width:2px\n\n  %% Style subgraphs\n  style calcofi fill:#F8FAFC,stroke:#CBD5E1,stroke-width:2px\n  style portals fill:#F8FAFC,stroke:#CBD5E1,stroke-width:2px\n  style meta fill:#F8FAFC,stroke:#CBD5E1,stroke-width:2px\nIn practice, CalCOFI is a partnership with various contributing members, so the authoritative dataset might flow differently, such as from EDI to the database to the other portals. The other portals, such as OBIS or ERDDAP, serve different audiences or purposes. The meta-portals like ODIS and Data.gov then index these portals to provide broader discovery of CalCOFI datasets.",
    "crumbs": [
      "<span class='chapter-number'>7</span>Â  <span class='chapter-title'>portals_a</span>"
    ]
  },
  {
    "objectID": "portals_b.html",
    "href": "portals_b.html",
    "title": "8Â  portals_b",
    "section": "",
    "text": "8.1 Portals\nâ€  Capability: ğŸ”´ none; ğŸŸ¡ partial; ğŸŸ¢ full",
    "crumbs": [
      "<span class='chapter-number'>8</span>Â  <span class='chapter-title'>portals_b</span>"
    ]
  },
  {
    "objectID": "portals_b.html#portals",
    "href": "portals_b.html#portals",
    "title": "8Â  portals_b",
    "section": "",
    "text": "Portal\nFull Archive\nVersioning\nDOI issued\nQuery by xyt\nQuery by taxa\nMultiple formats\nAPI Access\n\n\n\n\nEDI\nğŸŸ¢\nğŸŸ¢\nğŸŸ¢\nğŸŸ¡\nğŸŸ¡\nğŸ”´\nğŸŸ¡\n\n\nNCEI\nğŸŸ¢\nğŸŸ¢\nğŸŸ¢\nğŸ”´\nğŸ”´\nğŸ”´\nğŸŸ¡\n\n\nOBIS\nğŸŸ¡\nğŸŸ¡\nğŸŸ¡\nğŸŸ¢\nğŸŸ¢\nğŸŸ¡\nğŸŸ¢\n\n\nERDDAP\nğŸŸ¡\nğŸ”´\nğŸ”´\nğŸŸ¢\nğŸŸ¡\nğŸŸ¢\nğŸŸ¢",
    "crumbs": [
      "<span class='chapter-number'>8</span>Â  <span class='chapter-title'>portals_b</span>"
    ]
  },
  {
    "objectID": "refs.html",
    "href": "refs.html",
    "title": "9Â  References",
    "section": "",
    "text": "9.1 R packages",
    "crumbs": [
      "<span class='chapter-number'>9</span>Â  <span class='chapter-title'>References</span>"
    ]
  },
  {
    "objectID": "refs.html#r-packages",
    "href": "refs.html#r-packages",
    "title": "9Â  References",
    "section": "",
    "text": "API: plumber (Schloerke and Allen 2024)\ndocs: Quarto (Allaire and Dervieux 2024)\napps: Shiny (Chang et al. 2024)\n\n\n\n\n\nAllaire, JJ, and Christophe Dervieux. 2024. Quarto: R Interface to Quarto Markdown Publishing System. https://github.com/quarto-dev/quarto-r.\n\n\nChang, Winston, Joe Cheng, JJ Allaire, Carson Sievert, Barret Schloerke, Yihui Xie, Jeff Allen, Jonathan McPherson, Alan Dipert, and Barbara Borges. 2024. Shiny: Web Application Framework for r. https://shiny.posit.co/.\n\n\nSchloerke, Barret, and Jeff Allen. 2024. Plumber: An API Generator for r. https://www.rplumber.io.",
    "crumbs": [
      "<span class='chapter-number'>9</span>Â  <span class='chapter-title'>References</span>"
    ]
  }
]